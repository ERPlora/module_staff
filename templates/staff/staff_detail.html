{% extends "ui/module_content.html" %}
{% load i18n %}

{% block page_header %}
<ion-toolbar>
    <ion-buttons slot="start">
        <ion-back-button default-href="{% url 'staff:staff_list' %}"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ staff.full_name }}</ion-title>
    <ion-buttons slot="end">
        <ion-button href="{% url 'staff:staff_edit' staff.id %}">
            <ion-icon slot="icon-only" name="create-outline"></ion-icon>
        </ion-button>
    </ion-buttons>
</ion-toolbar>
{% endblock %}

{% block page_content %}
<div class="detail-container">
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="avatar-large">
            {% if staff.photo %}
            <img src="{{ staff.photo.url }}" alt="{{ staff.full_name }}">
            {% else %}
            <ion-icon name="person-circle-outline"></ion-icon>
            {% endif %}
        </div>
        <h1>{{ staff.full_name }}</h1>
        <p class="role-text">{{ staff.role.name|default:"-" }}</p>
        <ion-badge color="{% if staff.status == 'active' %}success{% elif staff.status == 'on_leave' %}warning{% elif staff.status == 'inactive' %}medium{% else %}danger{% endif %}">
            {{ staff.get_status_display }}
        </ion-badge>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        {% if staff.phone %}
        <ion-button href="tel:{{ staff.phone }}" fill="outline" size="small">
            <ion-icon slot="start" name="call-outline"></ion-icon>
            {% trans "Call" %}
        </ion-button>
        {% endif %}
        {% if staff.email %}
        <ion-button href="mailto:{{ staff.email }}" fill="outline" size="small">
            <ion-icon slot="start" name="mail-outline"></ion-icon>
            {% trans "Email" %}
        </ion-button>
        {% endif %}
        <ion-button href="{% url 'staff:schedule_list' staff.id %}" fill="outline" size="small">
            <ion-icon slot="start" name="calendar-outline"></ion-icon>
            {% trans "Schedules" %}
        </ion-button>
    </div>

    <!-- Contact Info -->
    <ion-card>
        <ion-card-header>
            <ion-card-title>{% trans "Contact Information" %}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-list lines="none">
                {% if staff.email %}
                <ion-item>
                    <ion-icon slot="start" name="mail-outline"></ion-icon>
                    <ion-label>{{ staff.email }}</ion-label>
                </ion-item>
                {% endif %}
                {% if staff.phone %}
                <ion-item>
                    <ion-icon slot="start" name="call-outline"></ion-icon>
                    <ion-label>{{ staff.phone }}</ion-label>
                </ion-item>
                {% endif %}
                {% if staff.employee_id %}
                <ion-item>
                    <ion-icon slot="start" name="id-card-outline"></ion-icon>
                    <ion-label>{{ staff.employee_id }}</ion-label>
                </ion-item>
                {% endif %}
            </ion-list>
        </ion-card-content>
    </ion-card>

    <!-- Employment Details -->
    <ion-card>
        <ion-card-header>
            <ion-card-title>{% trans "Employment Details" %}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-list lines="none">
                <ion-item>
                    <ion-label>
                        <p>{% trans "Hire Date" %}</p>
                        <h3>{{ staff.hire_date|date:"M d, Y"|default:"-" }}</h3>
                    </ion-label>
                </ion-item>
                <ion-item>
                    <ion-label>
                        <p>{% trans "Hourly Rate" %}</p>
                        <h3>{{ staff.hourly_rate|default:"-" }}</h3>
                    </ion-label>
                </ion-item>
                <ion-item>
                    <ion-label>
                        <p>{% trans "Commission Rate" %}</p>
                        <h3>{% if staff.commission_rate %}{{ staff.commission_rate }}%{% else %}-{% endif %}</h3>
                    </ion-label>
                </ion-item>
                <ion-item>
                    <ion-label>
                        <p>{% trans "Bookable" %}</p>
                        <h3>{% if staff.is_bookable %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}</h3>
                    </ion-label>
                </ion-item>
            </ion-list>
        </ion-card-content>
    </ion-card>

    <!-- Services -->
    {% if staff.is_bookable %}
    <ion-card>
        <ion-card-header>
            <ion-card-title>{% trans "Assigned Services" %}</ion-card-title>
            <ion-button slot="end" fill="clear" size="small" href="{% url 'staff:staff_services' staff.id %}">
                {% trans "Edit" %}
            </ion-button>
        </ion-card-header>
        <ion-card-content>
            {% if services %}
            <div class="service-chips">
                {% for service in services %}
                <ion-chip>
                    <ion-label>{{ service.service.name }}</ion-label>
                </ion-chip>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted">{% trans "No services assigned" %}</p>
            {% endif %}
        </ion-card-content>
    </ion-card>
    {% endif %}

    <!-- Bio -->
    {% if staff.bio %}
    <ion-card>
        <ion-card-header>
            <ion-card-title>{% trans "Bio" %}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <p>{{ staff.bio }}</p>
        </ion-card-content>
    </ion-card>
    {% endif %}

    <!-- Current Schedule -->
    {% if current_schedule %}
    <ion-card>
        <ion-card-header>
            <ion-card-title>{% trans "Current Schedule" %}</ion-card-title>
            <ion-button slot="end" fill="clear" size="small" href="{% url 'staff:schedule_detail' current_schedule.id %}">
                {% trans "View" %}
            </ion-button>
        </ion-card-header>
        <ion-card-content>
            <ion-list lines="none">
                {% for hours in current_schedule.working_hours.all %}
                <ion-item>
                    <ion-label>{{ hours.get_day_of_week_display }}</ion-label>
                    <ion-note slot="end">
                        {% if hours.is_day_off %}
                        {% trans "Day Off" %}
                        {% else %}
                        {{ hours.start_time|time:"H:i" }} - {{ hours.end_time|time:"H:i" }}
                        {% endif %}
                    </ion-note>
                </ion-item>
                {% endfor %}
            </ion-list>
        </ion-card-content>
    </ion-card>
    {% endif %}

    <!-- Notes -->
    {% if staff.notes %}
    <ion-card>
        <ion-card-header>
            <ion-card-title>{% trans "Internal Notes" %}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <p class="text-muted">{{ staff.notes }}</p>
        </ion-card-content>
    </ion-card>
    {% endif %}

    <!-- Danger Zone -->
    <ion-card color="danger">
        <ion-card-header>
            <ion-card-title>{% trans "Danger Zone" %}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-button
                color="light"
                expand="block"
                hx-delete="{% url 'staff:staff_delete' staff.id %}"
                hx-confirm="{% trans 'Are you sure you want to delete this staff member? This action cannot be undone.' %}">
                <ion-icon slot="start" name="trash-outline"></ion-icon>
                {% trans "Delete Staff Member" %}
            </ion-button>
        </ion-card-content>
    </ion-card>
</div>

<style>
.detail-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 16px;
}

.profile-header {
    text-align: center;
    padding: 24px 0;
}

.avatar-large {
    width: 120px;
    height: 120px;
    margin: 0 auto 16px;
    border-radius: 50%;
    overflow: hidden;
    background: var(--ion-color-light);
    display: flex;
    align-items: center;
    justify-content: center;
}

.avatar-large img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-large ion-icon {
    font-size: 80px;
    color: var(--ion-color-medium);
}

.profile-header h1 {
    margin: 0 0 4px;
    font-size: 1.5rem;
}

.role-text {
    color: var(--ion-color-medium);
    margin: 0 0 8px;
}

.quick-actions {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 16px;
}

.service-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
</style>
{% endblock %}
