{% load djicons i18n djicons djicons %}

<div class="p-4">
    <!-- Back Button -->
    <button class="btn btn-ghost mb-3"
            hx-get="{% url 'staff:schedules' %}"
            hx-target="#main-content-area"
            hx-push-url="true">
        {% icon "arrow-back-outline" css_class="mr-1" %}
        {% trans "Back to Schedules" %}
    </button>

    <!-- Header Card -->
    <div class="card mb-4">
        <div class="card-header">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center">
                        {% icon "calendar-outline" css_class="text-2xl text-primary" %}
                    </div>
                    <div>
                        <h2 class="text-xl font-bold">{{ schedule.name }}</h2>
                        <span class="text-muted">{{ staff.full_name }}</span>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    {% if schedule.is_default %}
                    <span class="badge color-primary">{% trans "Default" %}</span>
                    {% endif %}
                    <span class="badge color-{% if schedule.is_active %}success{% else %}medium{% endif %}">
                        {% if schedule.is_active %}{% trans "Active" %}{% else %}{% trans "Inactive" %}{% endif %}
                    </span>
                </div>
            </div>
        </div>
        {% if schedule.effective_from or schedule.effective_until %}
        <div class="card-body">
            <div class="grid grid-cols-2 gap-4">
                <div class="p-3 rounded-lg bg-base-100">
                    <div class="text-xs text-muted uppercase font-semibold mb-1">{% trans "Effective From" %}</div>
                    <div class="text-lg font-semibold">{{ schedule.effective_from|date:"M d, Y"|default:"-" }}</div>
                </div>
                <div class="p-3 rounded-lg bg-base-100">
                    <div class="text-xs text-muted uppercase font-semibold mb-1">{% trans "Effective Until" %}</div>
                    <div class="text-lg font-semibold">{{ schedule.effective_until|date:"M d, Y"|default:"-" }}</div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Working Hours -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">{% icon "time-outline" css_class="text-primary" %} {% trans "Working Hours" %}</h3>
        </div>
        <div class="card-body p-0">
            {% if working_hours %}
            <div class="list">
                {% for hours in working_hours %}
                <div class="list-item">
                    <div class="list-item-start">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center {% if hours.is_working %}bg-success/10{% else %}bg-error/10{% endif %}">
                            {% if hours.is_working %}
                            {% icon "checkmark-outline" css_class="text-success" %}
                            {% else %}
                            {% icon "close-outline" css_class="text-error" %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="list-item-content">
                        <div class="list-item-label font-semibold">{{ hours.get_day_of_week_display }}</div>
                        {% if hours.is_working %}
                        <div class="list-item-note">
                            {{ hours.start_time|time:"H:i" }} - {{ hours.end_time|time:"H:i" }}
                            {% if hours.break_start and hours.break_end %}
                            &middot; {% trans "Break" %}: {{ hours.break_start|time:"H:i" }} - {{ hours.break_end|time:"H:i" }}
                            {% endif %}
                        </div>
                        {% else %}
                        <div class="list-item-note text-muted">{% trans "Day Off" %}</div>
                        {% endif %}
                    </div>
                    <div class="list-item-end text-muted">
                        {% if hours.is_working %}
                        {{ hours.working_minutes }} {% trans "min" %}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8 text-muted">
                {% icon "time-outline" css_class="text-3xl block mx-auto mb-2" %}
                <p>{% trans "No working hours defined" %}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Danger Zone -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title text-error">{% trans "Danger Zone" %}</h3>
        </div>
        <div class="card-body">
            <div class="flex items-center justify-between">
                <div>
                    <h4 class="font-semibold">{% trans "Delete Schedule" %}</h4>
                    <p class="text-sm text-muted">{% trans "Remove this schedule permanently" %}</p>
                </div>
                <button class="btn btn-sm btn-outline color-error"
                        onclick="deleteSchedule('{{ schedule.id }}')">
                    {% icon "trash-outline" css_class="mr-1" %}
                    {% trans "Delete" %}
                </button>
            </div>
        </div>
    </div>
</div>

<script>
async function deleteSchedule(id) {
    if (!confirm('{% trans "Are you sure you want to delete this schedule?" %}')) return;
    try {
        const response = await fetch('{% url "staff:schedule_delete" "00000000-0000-0000-0000-000000000000" %}'.replace('00000000-0000-0000-0000-000000000000', id), {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'}
        });
        if (response.ok) {
            htmx.ajax('GET', '{% url "staff:schedules" %}', {target: '#main-content-area', pushUrl: true});
        }
    } catch (e) { console.error(e); }
}
</script>
