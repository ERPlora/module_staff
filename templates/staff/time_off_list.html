{% extends "ui/module_content.html" %}
{% load i18n %}

{% block page_header %}
<ion-toolbar>
    <ion-buttons slot="start">
        <ion-back-button default-href="{% url 'staff:dashboard' %}"></ion-back-button>
    </ion-buttons>
    <ion-title>{% trans "Time Off Requests" %}</ion-title>
</ion-toolbar>
{% endblock %}

{% block page_content %}
<div class="time-off-container">
    <!-- Filter Chips -->
    <div class="filter-chips">
        <ion-chip
            {% if not request.GET.status %}color="primary"{% endif %}
            onclick="filterByStatus('')">
            {% trans "All" %}
        </ion-chip>
        <ion-chip
            {% if request.GET.status == 'pending' %}color="primary"{% endif %}
            onclick="filterByStatus('pending')">
            {% trans "Pending" %}
        </ion-chip>
        <ion-chip
            {% if request.GET.status == 'approved' %}color="primary"{% endif %}
            onclick="filterByStatus('approved')">
            {% trans "Approved" %}
        </ion-chip>
        <ion-chip
            {% if request.GET.status == 'rejected' %}color="primary"{% endif %}
            onclick="filterByStatus('rejected')">
            {% trans "Rejected" %}
        </ion-chip>
    </div>

    <!-- Time Off List -->
    <div id="time-off-list">
        {% if time_off_list %}
        <ion-list>
            {% for request in time_off_list %}
            <ion-item-sliding>
                <ion-item>
                    <ion-avatar slot="start">
                        {% if request.staff.photo %}
                        <img src="{{ request.staff.photo.url }}" alt="{{ request.staff.full_name }}">
                        {% else %}
                        <ion-icon name="person-circle-outline" style="font-size: 40px;"></ion-icon>
                        {% endif %}
                    </ion-avatar>
                    <ion-label>
                        <h2>{{ request.staff.full_name }}</h2>
                        <p>{{ request.start_date|date:"M d" }} - {{ request.end_date|date:"M d, Y" }}</p>
                        <p class="text-muted">{{ request.get_leave_type_display }}</p>
                        {% if request.reason %}
                        <p class="text-muted">{{ request.reason|truncatechars:50 }}</p>
                        {% endif %}
                    </ion-label>
                    <ion-badge slot="end" color="{% if request.status == 'approved' %}success{% elif request.status == 'rejected' %}danger{% else %}warning{% endif %}">
                        {{ request.get_status_display }}
                    </ion-badge>
                </ion-item>

                {% if request.status == 'pending' %}
                <ion-item-options side="end">
                    <ion-item-option color="success"
                        hx-post="{% url 'staff:time_off_approve' request.id %}"
                        hx-target="closest ion-item-sliding"
                        hx-swap="outerHTML">
                        <ion-icon slot="icon-only" name="checkmark-outline"></ion-icon>
                    </ion-item-option>
                    <ion-item-option color="danger"
                        hx-post="{% url 'staff:time_off_reject' request.id %}"
                        hx-target="closest ion-item-sliding"
                        hx-swap="outerHTML">
                        <ion-icon slot="icon-only" name="close-outline"></ion-icon>
                    </ion-item-option>
                </ion-item-options>
                {% endif %}
            </ion-item-sliding>
            {% endfor %}
        </ion-list>
        {% else %}
        <div class="empty-state">
            <ion-icon name="calendar-outline"></ion-icon>
            <h3>{% trans "No Time Off Requests" %}</h3>
            <p>{% trans "Time off requests will appear here" %}</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
function filterByStatus(status) {
    const url = new URL(window.location.href);
    if (status) {
        url.searchParams.set('status', status);
    } else {
        url.searchParams.delete('status');
    }
    window.location.href = url.toString();
}
</script>

<style>
.time-off-container {
    max-width: 600px;
    margin: 0 auto;
}

.filter-chips {
    display: flex;
    gap: 8px;
    padding: 8px 16px;
    overflow-x: auto;
}

.empty-state {
    text-align: center;
    padding: 48px 16px;
    color: var(--ion-color-medium);
}

.empty-state ion-icon {
    font-size: 64px;
    margin-bottom: 16px;
}

.empty-state h3 {
    margin: 0 0 8px;
    color: var(--ion-text-color);
}
</style>
{% endblock %}
